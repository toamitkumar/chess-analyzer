{"ast":null,"code":"import * as drag from './drag.js';\nimport * as draw from './draw.js';\nimport { drop } from './drop.js';\nimport { isRightButton } from './util.js';\nexport function bindBoard(s, onResize) {\n  const boardEl = s.dom.elements.board;\n  if ('ResizeObserver' in window) new ResizeObserver(onResize).observe(s.dom.elements.wrap);\n  if (s.disableContextMenu || s.drawable.enabled) {\n    boardEl.addEventListener('contextmenu', e => e.preventDefault());\n  }\n  if (s.viewOnly) return;\n  // Cannot be passive, because we prevent touch scrolling and dragging of\n  // selected elements.\n  const onStart = startDragOrDraw(s);\n  boardEl.addEventListener('touchstart', onStart, {\n    passive: false\n  });\n  boardEl.addEventListener('mousedown', onStart, {\n    passive: false\n  });\n}\n// returns the unbind function\nexport function bindDocument(s, onResize) {\n  const unbinds = [];\n  // Old versions of Edge and Safari do not support ResizeObserver. Send\n  // chessground.resize if a user action has changed the bounds of the board.\n  if (!('ResizeObserver' in window)) unbinds.push(unbindable(document.body, 'chessground.resize', onResize));\n  if (!s.viewOnly) {\n    const onmove = dragOrDraw(s, drag.move, draw.move);\n    const onend = dragOrDraw(s, drag.end, draw.end);\n    for (const ev of ['touchmove', 'mousemove']) unbinds.push(unbindable(document, ev, onmove));\n    for (const ev of ['touchend', 'mouseup']) unbinds.push(unbindable(document, ev, onend));\n    const onScroll = () => s.dom.bounds.clear();\n    unbinds.push(unbindable(document, 'scroll', onScroll, {\n      capture: true,\n      passive: true\n    }));\n    unbinds.push(unbindable(window, 'resize', onScroll, {\n      passive: true\n    }));\n  }\n  return () => unbinds.forEach(f => f());\n}\nfunction unbindable(el, eventName, callback, options) {\n  el.addEventListener(eventName, callback, options);\n  return () => el.removeEventListener(eventName, callback, options);\n}\nconst startDragOrDraw = s => e => {\n  if (s.draggable.current) drag.cancel(s);else if (s.drawable.current) draw.cancel(s);else if (e.shiftKey || isRightButton(e)) {\n    if (s.drawable.enabled) draw.start(s, e);\n  } else if (!s.viewOnly) {\n    if (s.dropmode.active) drop(s, e);else drag.start(s, e);\n  }\n};\nconst dragOrDraw = (s, withDrag, withDraw) => e => {\n  if (s.drawable.current) {\n    if (s.drawable.enabled) withDraw(s, e);\n  } else if (!s.viewOnly) withDrag(s, e);\n};\n//# sourceMappingURL=events.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}