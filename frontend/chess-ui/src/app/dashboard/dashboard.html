<!-- Navigation -->
<app-navigation></app-navigation>

<!-- Main Content -->
<div class="dashboard-layout">
  <div class="container">
    <!-- Header Section -->
    <div class="dashboard-header">
      <div class="header-content">
        <h1 class="page-title">Performance Dashboard</h1>
        <p class="page-subtitle">Track your chess progress and analyze your gameplay</p>
      </div>
      <div class="header-actions">
        <app-tournament-selector 
          [selectedTournamentId]="selectedTournamentId"
          (tournamentChange)="onTournamentChange($event)">
        </app-tournament-selector>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="loading">
      <div class="loading-card">
        <div class="loading-spinner">
          <mat-spinner diameter="40"></mat-spinner>
        </div>
        <h3>Loading Performance Data</h3>
        <p>Analyzing your chess games...</p>
      </div>
    </div>

    <!-- Error State -->
    <div class="error-state" *ngIf="error && !loading">
      <div class="error-card">
        <mat-icon class="error-icon">error_outline</mat-icon>
        <h3>Something went wrong</h3>
        <p>{{ error }}</p>
        <button class="btn btn-primary" (click)="refreshData()">
          <mat-icon>refresh</mat-icon>
          Try Again
        </button>
      </div>
    </div>

    <!-- Dashboard Content -->
    <div class="dashboard-content" *ngIf="!loading && !error">
      <!-- Stats Grid -->
      <section class="stats-section">
        <div class="section-header">
          <h2 class="section-title">
            <mat-icon>analytics</mat-icon>
            Performance Overview
          </h2>
        </div>
        
        <div class="stats-grid">
          <app-stat-card
            icon="sports_esports"
            [value]="performance.white?.games || 0"
            label="Total Games"
            [description]="(performance.overall?.overallWinRate || 0) + '% win rate'"
            variant="default"
            iconColor="default"
            (cardClick)="navigateToGames()">
          </app-stat-card>

          <app-stat-card
            icon="trending_up"
            [value]="(performance.white?.winRate || 0) + '%'"
            label="Win Rate (White)"
            [description]="(performance.black?.winRate || 0) + '% as black'"
            variant="success"
            iconColor="success">
          </app-stat-card>

          <app-stat-card
            icon="target"
            [value]="(performance.overall?.avgAccuracy || 0) + '%'"
            label="Avg Accuracy"
            [description]="selectedTournamentId ? 'Tournament average' : 'Overall performance'"
            variant="default"
            iconColor="warning">
          </app-stat-card>

          <app-stat-card
            icon="warning"
            [value]="performance.overall?.totalBlunders || 0"
            label="Total Blunders"
            description="Mistakes to review"
            variant="error"
            iconColor="error">
          </app-stat-card>
        </div>
      </section>

      <!-- Charts Section -->
      <section class="charts-section">
        <div class="section-header">
          <h2 class="section-title">
            <mat-icon>show_chart</mat-icon>
            Performance Trends
          </h2>
        </div>

        <div class="charts-grid">
          <!-- Rating Chart -->
          <div class="chart-card">
            <div class="chart-header">
              <h3 class="chart-title">
                <mat-icon>trending_up</mat-icon>
                Rating Progress
              </h3>
            </div>
            <div class="chart-content">
              <canvas id="ratingChart"></canvas>
            </div>
          </div>

          <!-- Accuracy Chart -->
          <div class="chart-card">
            <div class="chart-header">
              <h3 class="chart-title">
                <mat-icon>analytics</mat-icon>
                Move Accuracy
              </h3>
            </div>
            <div class="chart-content">
              <canvas id="centipawnChart"></canvas>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="(performance.white?.games || 0) === 0 && (performance.black?.games || 0) === 0 && !loading">
      <div class="empty-card">
        <div class="empty-icon">ðŸ“Š</div>
        <h3>{{ selectedTournamentId ? 'No Games in This Tournament' : 'No Games Analyzed Yet' }}</h3>
        <p>{{ selectedTournamentId ? 'This tournament doesn\'t have any analyzed games.' : 'Upload your PGN files to start analyzing your chess performance.' }}</p>
        <button class="btn btn-primary" routerLink="/import">
          <mat-icon>upload</mat-icon>
          Upload PGN Files
        </button>
      </div>
    </div>
  </div>
</div>
