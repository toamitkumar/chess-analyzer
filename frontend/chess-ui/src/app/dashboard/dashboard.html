<div class="dashboard-container">
  <!-- Header Section -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1 class="dashboard-title">{{ getTournamentContext() }}</h1>
      <p class="dashboard-subtitle">
        {{ selectedTournamentId ? 'Tournament-specific analysis and performance metrics' : 'Analyze your chess games and track your progress' }}
      </p>
    </div>
    
    <div class="header-actions">
      <app-tournament-selector 
        [selectedTournamentId]="selectedTournamentId"
        (tournamentChange)="onTournamentChange($event)">
      </app-tournament-selector>
      <button mat-raised-button color="primary" (click)="refreshData()" [disabled]="loading" class="refresh-btn">
        <mat-icon>refresh</mat-icon>
        {{ loading ? 'Loading...' : 'Refresh' }}
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading">
    <mat-card class="loading-card">
      <mat-card-content class="text-center p-8">
        <mat-spinner diameter="40"></mat-spinner>
        <p class="text-lg" style="margin-top: 1rem;">Loading performance data...</p>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Error State -->
  <div class="error-container" *ngIf="error && !loading">
    <mat-card class="error-card">
      <mat-card-content class="text-center p-8">
        <mat-icon class="error-icon">error_outline</mat-icon>
        <h3>Oops! Something went wrong</h3>
        <p>{{ error }}</p>
        <button mat-raised-button color="primary" (click)="refreshData()">
          <mat-icon>refresh</mat-icon>
          Try Again
        </button>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Main Content -->
  <div class="dashboard-content" *ngIf="!loading && !error">
    <!-- Performance Stats Grid -->
    <div class="stats-section" *ngIf="(performance.white?.games || 0) > 0 || (performance.black?.games || 0) > 0">
      <h2 class="section-title">Performance Overview</h2>
      <div class="grid grid-cols-4 stats-grid">
        <mat-card class="stat-card games-card">
          <mat-card-content class="stat-content">
            <div class="stat-icon">üéØ</div>
            <div class="stat-value">{{ performance.white?.games || 0 }}</div>
            <div class="stat-label">Total Games</div>
            <div class="stat-detail">{{ performance.overall?.overallWinRate || 0 }}% win rate</div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card winrate-card">
          <mat-card-content class="stat-content">
            <div class="stat-icon">‚ö°</div>
            <div class="stat-value">{{ performance.white?.winRate || 0 }}%</div>
            <div class="stat-label">Win Rate (White)</div>
            <div class="stat-detail">{{ performance.black?.winRate || 0 }}% as black</div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card accuracy-card">
          <mat-card-content class="stat-content">
            <div class="stat-icon">üéØ</div>
            <div class="stat-value">{{ performance.overall?.avgAccuracy || 0 }}%</div>
            <div class="stat-label">Avg Accuracy</div>
            <div class="stat-detail">{{ selectedTournamentId ? 'Tournament avg' : 'Overall performance' }}</div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card blunders-card">
          <mat-card-content class="stat-content">
            <div class="stat-icon">‚ö†Ô∏è</div>
            <div class="stat-value">{{ performance.overall?.totalBlunders || 0 }}</div>
            <div class="stat-label">Total Blunders</div>
            <div class="stat-detail">Mistakes to review</div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section" *ngIf="(performance.white?.games || 0) > 0 || (performance.black?.games || 0) > 0">
      <h2 class="section-title">Performance Trends</h2>
      <div class="grid grid-cols-2 charts-grid">
        <mat-card class="chart-card">
          <mat-card-header>
            <mat-card-title class="chart-title">
              <mat-icon>trending_up</mat-icon>
              Rating Progression
            </mat-card-title>
          </mat-card-header>
          <mat-card-content class="chart-content">
            <canvas id="ratingChart"></canvas>
          </mat-card-content>
        </mat-card>

        <mat-card class="chart-card">
          <mat-card-header>
            <mat-card-title class="chart-title">
              <mat-icon>analytics</mat-icon>
              Centipawn Loss Trend
            </mat-card-title>
          </mat-card-header>
          <mat-card-content class="chart-content">
            <canvas id="centipawnChart"></canvas>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="(performance.white?.games || 0) === 0 && (performance.black?.games || 0) === 0">
      <mat-card class="empty-card">
        <mat-card-content class="text-center p-8">
          <div class="empty-icon">üìä</div>
          <h3>{{ selectedTournamentId ? 'No Games in This Tournament' : 'No Games Analyzed Yet' }}</h3>
          <p>{{ selectedTournamentId ? 'Try selecting a different tournament or upload more PGN files.' : 'Upload some PGN files to see your performance statistics!' }}</p>
          <button mat-raised-button color="primary" routerLink="/import" class="cta-button">
            <mat-icon>upload</mat-icon>
            Upload PGN Files
          </button>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>

<style>
.dashboard-container {
  min-height: calc(100vh - 120px);
}

.dashboard-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 2rem;
  padding: 2rem;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20px);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.header-content h1 {
  margin: 0;
  font-size: 2rem;
  font-weight: 700;
  color: #333;
}

.header-content p {
  margin: 0.5rem 0 0 0;
  color: #666;
  font-size: 1rem;
}

.header-actions {
  display: flex;
  gap: 1rem;
  align-items: center;
}

.refresh-btn {
  display: flex !important;
  align-items: center;
  gap: 0.5rem;
}

.section-title {
  font-size: 1.5rem;
  font-weight: 600;
  color: #333;
  margin-bottom: 1.5rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.stats-section, .charts-section {
  margin-bottom: 3rem;
}

.stats-grid {
  gap: 1.5rem;
}

.stat-card {
  background: linear-gradient(135deg, #fff 0%, #f8fafc 100%) !important;
  border: 1px solid rgba(0, 0, 0, 0.05) !important;
  transition: all 0.3s ease !important;
}

.stat-content {
  text-align: center;
  padding: 2rem 1rem !important;
}

.stat-icon {
  font-size: 2rem;
  margin-bottom: 1rem;
}

.stat-value {
  font-size: 2.5rem;
  font-weight: 700;
  color: #333;
  margin-bottom: 0.5rem;
}

.stat-label {
  font-size: 0.875rem;
  font-weight: 600;
  color: #666;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 0.5rem;
}

.stat-detail {
  font-size: 0.75rem;
  color: #888;
}

.games-card { border-left: 4px solid #667eea !important; }
.winrate-card { border-left: 4px solid #10b981 !important; }
.accuracy-card { border-left: 4px solid #f59e0b !important; }
.blunders-card { border-left: 4px solid #ef4444 !important; }

.charts-grid {
  gap: 1.5rem;
}

.chart-card {
  background: rgba(255, 255, 255, 0.95) !important;
}

.chart-title {
  display: flex !important;
  align-items: center;
  gap: 0.5rem;
  font-size: 1.125rem !important;
  font-weight: 600 !important;
}

.chart-content {
  padding: 1rem !important;
  min-height: 300px;
}

.loading-container, .error-container, .empty-state {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 400px;
}

.loading-card, .error-card, .empty-card {
  max-width: 500px;
  width: 100%;
}

.error-icon {
  font-size: 3rem !important;
  color: #ef4444;
  margin-bottom: 1rem;
}

.empty-icon {
  font-size: 4rem;
  margin-bottom: 1rem;
}

.cta-button {
  display: flex !important;
  align-items: center;
  gap: 0.5rem;
  margin-top: 1rem !important;
}

@media (max-width: 768px) {
  .dashboard-header {
    flex-direction: column;
    gap: 1rem;
    padding: 1rem;
  }
  
  .header-actions {
    width: 100%;
    justify-content: center;
  }
  
  .stat-value {
    font-size: 2rem;
  }
  
  .chart-content {
    min-height: 250px;
  }
}
</style>
