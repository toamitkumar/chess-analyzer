<div class="lichess-analysis-layout">
  <!-- Left Column: Chessboard -->
  <div class="board-column">
    <div class="board-container">
      <div #chessboard class="chessboard"></div>
    </div>
    <!-- Board Controls -->
    <div class="board-controls">
      <button type="button" (click)="goToFirstMove()" [disabled]="moveHistory.length === 0 || currentMoveIndex === -1" class="nav-btn" title="Go to start">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="11,17 6,12 11,7"/><polyline points="18,17 13,12 18,7"/></svg>
      </button>
      <button type="button" (click)="goToPreviousMove()" [disabled]="currentMoveIndex < 0" class="nav-btn" title="Previous">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15,18 9,12 15,6"/></svg>
      </button>
      <span class="move-counter">{{ getCurrentMoveDisplay() }}</span>
      <button type="button" (click)="goToNextMove()" [disabled]="currentMoveIndex >= moveHistory.length - 1" class="nav-btn" title="Next">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9,18 15,12 9,6"/></svg>
      </button>
      <button type="button" (click)="goToLastMove()" [disabled]="moveHistory.length === 0 || currentMoveIndex >= moveHistory.length - 1" class="nav-btn" title="Go to end">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="13,17 18,12 13,7"/><polyline points="6,17 11,12 6,7"/></svg>
      </button>
      <div class="board-actions">
        <button type="button" (click)="undoMove()" class="action-btn" title="Undo">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7v6h6"/><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/></svg>
        </button>
        <button type="button" (click)="resetBoard()" class="action-btn" title="Reset">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
        </button>
      </div>
    </div>
    <!-- FEN Display -->
    <div class="fen-section">
      <label>FEN</label>
      <input type="text" [value]="getCurrentFen()" readonly class="fen-input" />
    </div>
    <!-- PGN Textarea -->
    <div class="pgn-section">
      <div class="pgn-header">
        <label>PGN</label>
        <button type="button" (click)="verifyMoves()" [disabled]="!manualPGN.moves.trim()" class="verify-btn">Verify</button>
      </div>
      <textarea [(ngModel)]="manualPGN.moves" name="moves" rows="4" placeholder="Play moves on board or type/paste PGN" (paste)="onPgnPaste($event)" (input)="onPgnInput()" [class.error]="movesValidationError" class="pgn-input"></textarea>
      <div *ngIf="movesValidationError" class="validation-error">{{ movesValidationError }}</div>
      <div *ngIf="!movesValidationError && manualPGN.moves" class="validation-success">âœ“ Valid</div>
    </div>
  </div>

  <!-- Right Column: Game Details Form -->
  <div class="form-column">
    <div class="form-panel">
      <h3 class="panel-title">Game Details</h3>
      <form (ngSubmit)="handleManualSubmit()" #manualForm="ngForm" class="game-form">
        <!-- Tournament -->
        <div class="form-group">
          <label>Tournament *</label>
          <input type="text" [(ngModel)]="manualPGN.tournamentName" name="tournamentName" required placeholder="Club Championship 2025" />
        </div>

        <!-- Player Color -->
        <div class="form-group">
          <label>Your Color *</label>
          <div class="radio-group">
            <label class="radio-label"><input type="radio" [(ngModel)]="manualPGN.playerColor" name="playerColor" value="white" required /> White</label>
            <label class="radio-label"><input type="radio" [(ngModel)]="manualPGN.playerColor" name="playerColor" value="black" required /> Black</label>
          </div>
        </div>

        <!-- Opponent -->
        <div class="form-group">
          <label>Opponent *</label>
          <input type="text" [(ngModel)]="manualPGN.opponent" name="opponent" required placeholder="John Doe" />
        </div>

        <!-- Ratings Row -->
        <div class="form-row">
          <div class="form-group">
            <label>Your Rating</label>
            <input type="number" [(ngModel)]="manualPGN.playerElo" name="playerElo" placeholder="1500" min="0" max="3000" />
          </div>
          <div class="form-group">
            <label>Opponent Rating</label>
            <input type="number" [(ngModel)]="manualPGN.opponentElo" name="opponentElo" placeholder="1600" min="0" max="3000" />
          </div>
        </div>

        <!-- Date & Result Row -->
        <div class="form-row">
          <div class="form-group">
            <label>Date *</label>
            <input type="date" [(ngModel)]="manualPGN.date" name="date" required />
          </div>
          <div class="form-group">
            <label>Result *</label>
            <select [(ngModel)]="manualPGN.result" name="result" required>
              <option value="1-0">White Wins</option>
              <option value="0-1">Black Wins</option>
              <option value="1/2-1/2">Draw</option>
              <option value="*">Ongoing</option>
            </select>
          </div>
        </div>

        <!-- Time Control & Termination Row -->
        <div class="form-row">
          <div class="form-group">
            <label>Time Control *</label>
            <select [(ngModel)]="manualPGN.variant" name="variant" required>
              <option value="Rapid">Rapid</option>
              <option value="Classic">Classic</option>
              <option value="Blitz">Blitz</option>
            </select>
          </div>
          <div class="form-group">
            <label>Termination *</label>
            <select [(ngModel)]="manualPGN.termination" name="termination" required>
              <option value="mate">Checkmate</option>
              <option value="resigned">Resigned</option>
              <option value="time-over">Time Over</option>
              <option value="draw-agreement">Draw Agreement</option>
            </select>
          </div>
        </div>

        <!-- Submit Buttons -->
        <div class="form-actions">
          <button type="submit" [disabled]="!manualForm.valid || !manualPGN.moves.trim() || !!movesValidationError || manualSubmitStatus === 'uploading'" class="btn-primary">
            <svg *ngIf="manualSubmitStatus === 'uploading'" class="spinner" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10" stroke-dasharray="32" stroke-dashoffset="12"/></svg>
            {{ manualSubmitStatus === 'uploading' ? 'Submitting...' : 'Submit Game' }}
          </button>
        </div>

        <!-- Status Messages -->
        <div *ngIf="manualSubmitStatus === 'success'" class="status-success">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22,4 12,14.01 9,11.01"/></svg>
          Game uploaded successfully!
        </div>
        <div *ngIf="manualSubmitStatus === 'error'" class="status-error">{{ manualSubmitError }}</div>
      </form>
    </div>
  </div>
</div>
