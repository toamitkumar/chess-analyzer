{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { Chess } from 'chess.js';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nconst _c0 = [\"chessBoard\"];\nfunction ChessBoardComponent_span_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 15);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r1.currentMove.move);\n  }\n}\nfunction ChessBoardComponent_div_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 16)(1, \"span\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"span\", 17);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵclassMap(ctx_r1.getEvaluationClass());\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r1.formatEvaluation(ctx_r1.currentMove.evaluation));\n    i0.ɵɵadvance();\n    i0.ɵɵclassMap(ctx_r1.getMoveQualityClass());\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r1.getMoveQuality());\n  }\n}\nexport let ChessBoardComponent = /*#__PURE__*/(() => {\n  class ChessBoardComponent {\n    constructor() {\n      this.moves = [];\n      this.initialPosition = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1';\n      this.moveChanged = new EventEmitter();\n      this.currentMoveIndex = -1;\n      this.currentMove = null;\n      // Make Math available in template\n      this.Math = Math;\n      this.handleKeyPress = event => {\n        switch (event.key) {\n          case 'ArrowLeft':\n            event.preventDefault();\n            this.previousMove();\n            break;\n          case 'ArrowRight':\n            event.preventDefault();\n            this.nextMove();\n            break;\n          case 'Home':\n            event.preventDefault();\n            this.goToStart();\n            break;\n          case 'End':\n            event.preventDefault();\n            this.goToEnd();\n            break;\n        }\n      };\n    }\n    ngOnInit() {\n      this.game = new Chess(this.initialPosition);\n      this.setupKeyboardListeners();\n    }\n    ngAfterViewInit() {\n      this.initializeBoard();\n    }\n    ngOnDestroy() {\n      this.removeKeyboardListeners();\n      if (this.board) {\n        this.board.destroy();\n      }\n    }\n    initializeBoard() {\n      this.board = new ChessBoard(this.chessBoardElement.nativeElement, {\n        position: this.initialPosition,\n        draggable: false,\n        showNotation: true,\n        pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'\n      });\n    }\n    setupKeyboardListeners() {\n      document.addEventListener('keydown', this.handleKeyPress);\n    }\n    removeKeyboardListeners() {\n      document.removeEventListener('keydown', this.handleKeyPress);\n    }\n    goToStart() {\n      this.goToMove(-1);\n    }\n    previousMove() {\n      if (this.currentMoveIndex > -1) {\n        this.goToMove(this.currentMoveIndex - 1);\n      }\n    }\n    nextMove() {\n      if (this.currentMoveIndex < this.moves.length - 1) {\n        this.goToMove(this.currentMoveIndex + 1);\n      }\n    }\n    goToEnd() {\n      this.goToMove(this.moves.length - 1);\n    }\n    goToMove(moveIndex) {\n      this.currentMoveIndex = moveIndex;\n      this.currentMove = moveIndex >= 0 ? this.moves[moveIndex] : null;\n      // Reset game to initial position\n      this.game = new Chess(this.initialPosition);\n      // Play moves up to current position\n      for (let i = 0; i <= moveIndex; i++) {\n        if (this.moves[i]) {\n          try {\n            this.game.move(this.moves[i].move);\n          } catch (error) {\n            console.error('Invalid move:', this.moves[i].move, error);\n            break;\n          }\n        }\n      }\n      // Update board position\n      this.board.setPosition(this.game.fen());\n      // Highlight current move square\n      this.highlightCurrentMove();\n      // Emit move change event\n      this.moveChanged.emit(moveIndex);\n    }\n    highlightCurrentMove() {\n      // Clear previous highlights\n      this.board.removeMarkers();\n      if (this.currentMove) {\n        const moveQuality = this.getMoveQuality().toLowerCase();\n        const highlightClass = `highlight-${moveQuality}`;\n        // Parse move to get from/to squares\n        try {\n          const move = this.game.history({\n            verbose: true\n          }).pop();\n          if (move) {\n            this.board.addMarker(move.to, {\n              class: highlightClass\n            });\n          }\n        } catch (error) {\n          console.error('Error highlighting move:', error);\n        }\n      }\n    }\n    formatEvaluation(evaluation) {\n      if (Math.abs(evaluation) > 900) {\n        return evaluation > 0 ? '+M' : '-M';\n      }\n      return (evaluation / 100).toFixed(1);\n    }\n    getEvaluationClass() {\n      if (!this.currentMove) return 'eval-neutral';\n      const evaluation = this.currentMove.evaluation;\n      if (evaluation > 50) return 'eval-positive';\n      if (evaluation < -50) return 'eval-negative';\n      return 'eval-neutral';\n    }\n    getMoveQuality() {\n      if (!this.currentMove) return '';\n      if (this.currentMove.is_blunder) return 'Blunder';\n      if (this.currentMove.is_mistake) return 'Mistake';\n      if (this.currentMove.is_inaccuracy) return 'Inaccuracy';\n      if (this.currentMove.centipawn_loss <= 10) return 'Excellent';\n      return 'Good';\n    }\n    getMoveQualityClass() {\n      const quality = this.getMoveQuality().toLowerCase();\n      return `move-${quality}`;\n    }\n    static {\n      this.ɵfac = function ChessBoardComponent_Factory(t) {\n        return new (t || ChessBoardComponent)();\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ChessBoardComponent,\n        selectors: [[\"app-chess-board\"]],\n        viewQuery: function ChessBoardComponent_Query(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵviewQuery(_c0, 7);\n          }\n          if (rf & 2) {\n            let _t;\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.chessBoardElement = _t.first);\n          }\n        },\n        inputs: {\n          moves: \"moves\",\n          initialPosition: \"initialPosition\"\n        },\n        outputs: {\n          moveChanged: \"moveChanged\"\n        },\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 22,\n        vars: 7,\n        consts: [[\"chessBoard\", \"\"], [1, \"chess-board-container\"], [1, \"chess-board\"], [1, \"board-controls\"], [1, \"control-btn\", 3, \"click\", \"disabled\"], [\"fill\", \"none\", \"stroke\", \"currentColor\", \"viewBox\", \"0 0 24 24\", 1, \"h-5\", \"w-5\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"stroke-width\", \"2\", \"d\", \"M11 19l-7-7 7-7m8 14l-7-7 7-7\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"stroke-width\", \"2\", \"d\", \"M15 19l-7-7 7-7\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"stroke-width\", \"2\", \"d\", \"M9 5l7 7-7 7\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"stroke-width\", \"2\", \"d\", \"M13 5l7 7-7 7M5 5l7 7-7 7\"], [1, \"position-info\"], [1, \"move-info\"], [1, \"move-number\"], [\"class\", \"move-notation\", 4, \"ngIf\"], [\"class\", \"evaluation\", 4, \"ngIf\"], [1, \"move-notation\"], [1, \"evaluation\"], [1, \"move-quality\"]],\n        template: function ChessBoardComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            const _r1 = i0.ɵɵgetCurrentView();\n            i0.ɵɵelementStart(0, \"div\", 1);\n            i0.ɵɵelement(1, \"div\", 2, 0);\n            i0.ɵɵelementStart(3, \"div\", 3)(4, \"button\", 4);\n            i0.ɵɵlistener(\"click\", function ChessBoardComponent_Template_button_click_4_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.goToStart());\n            });\n            i0.ɵɵnamespaceSVG();\n            i0.ɵɵelementStart(5, \"svg\", 5);\n            i0.ɵɵelement(6, \"path\", 6);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵnamespaceHTML();\n            i0.ɵɵelementStart(7, \"button\", 4);\n            i0.ɵɵlistener(\"click\", function ChessBoardComponent_Template_button_click_7_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.previousMove());\n            });\n            i0.ɵɵnamespaceSVG();\n            i0.ɵɵelementStart(8, \"svg\", 5);\n            i0.ɵɵelement(9, \"path\", 7);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵnamespaceHTML();\n            i0.ɵɵelementStart(10, \"button\", 4);\n            i0.ɵɵlistener(\"click\", function ChessBoardComponent_Template_button_click_10_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.nextMove());\n            });\n            i0.ɵɵnamespaceSVG();\n            i0.ɵɵelementStart(11, \"svg\", 5);\n            i0.ɵɵelement(12, \"path\", 8);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵnamespaceHTML();\n            i0.ɵɵelementStart(13, \"button\", 4);\n            i0.ɵɵlistener(\"click\", function ChessBoardComponent_Template_button_click_13_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.goToEnd());\n            });\n            i0.ɵɵnamespaceSVG();\n            i0.ɵɵelementStart(14, \"svg\", 5);\n            i0.ɵɵelement(15, \"path\", 9);\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵnamespaceHTML();\n            i0.ɵɵelementStart(16, \"div\", 10)(17, \"div\", 11)(18, \"span\", 12);\n            i0.ɵɵtext(19);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(20, ChessBoardComponent_span_20_Template, 2, 1, \"span\", 13);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(21, ChessBoardComponent_div_21_Template, 5, 6, \"div\", 14);\n            i0.ɵɵelementEnd()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(4);\n            i0.ɵɵproperty(\"disabled\", ctx.currentMoveIndex === 0);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"disabled\", ctx.currentMoveIndex === 0);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"disabled\", ctx.currentMoveIndex >= ctx.moves.length - 1);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"disabled\", ctx.currentMoveIndex >= ctx.moves.length - 1);\n            i0.ɵɵadvance(6);\n            i0.ɵɵtextInterpolate1(\"Move \", ctx.Math.ceil((ctx.currentMoveIndex + 1) / 2), \"\");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.currentMove);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.currentMove);\n          }\n        },\n        dependencies: [CommonModule, i1.NgIf],\n        styles: [\".chess-board-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem;padding:1rem}.chess-board[_ngcontent-%COMP%]{width:400px;height:400px;border:2px solid #e2e8f0;border-radius:8px}@media (max-width: 640px){.chess-board[_ngcontent-%COMP%]{width:320px;height:320px}}.board-controls[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.control-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:40px;height:40px;border:1px solid #e2e8f0;border-radius:6px;background:#fff;cursor:pointer;transition:all .2s}.control-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#f8fafc;border-color:#cbd5e1}.control-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.position-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:.5rem;text-align:center}.move-info[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.move-number[_ngcontent-%COMP%]{font-weight:600;color:#374151}.move-notation[_ngcontent-%COMP%]{font-family:monospace;font-size:1.1rem;font-weight:500}.evaluation[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.eval-positive[_ngcontent-%COMP%]{color:#059669}.eval-negative[_ngcontent-%COMP%]{color:#dc2626}.eval-neutral[_ngcontent-%COMP%]{color:#6b7280}.move-excellent[_ngcontent-%COMP%]{color:#059669;font-weight:600}.move-good[_ngcontent-%COMP%]{color:#65a30d;font-weight:500}.move-inaccuracy[_ngcontent-%COMP%]{color:#d97706;font-weight:500}.move-mistake[_ngcontent-%COMP%]{color:#ea580c;font-weight:500}.move-blunder[_ngcontent-%COMP%]{color:#dc2626;font-weight:600}.cm-chessboard[_ngcontent-%COMP%]   .square.highlight-excellent[_ngcontent-%COMP%]{background-color:#22c55e4d!important}.cm-chessboard[_ngcontent-%COMP%]   .square.highlight-good[_ngcontent-%COMP%]{background-color:#84cc164d!important}.cm-chessboard[_ngcontent-%COMP%]   .square.highlight-inaccuracy[_ngcontent-%COMP%]{background-color:#fbbf244d!important}.cm-chessboard[_ngcontent-%COMP%]   .square.highlight-mistake[_ngcontent-%COMP%]{background-color:#fb923c4d!important}.cm-chessboard[_ngcontent-%COMP%]   .square.highlight-blunder[_ngcontent-%COMP%]{background-color:#ef44444d!important}\"]\n      });\n    }\n  }\n  return ChessBoardComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}