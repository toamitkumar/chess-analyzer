{"ast":null,"code":"import { pos2key, invRanks } from './util.js';\nimport * as cg from './types.js';\nexport const initial = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR';\nconst roles = {\n  p: 'pawn',\n  r: 'rook',\n  n: 'knight',\n  b: 'bishop',\n  q: 'queen',\n  k: 'king'\n};\nconst letters = {\n  pawn: 'p',\n  rook: 'r',\n  knight: 'n',\n  bishop: 'b',\n  queen: 'q',\n  king: 'k'\n};\nexport function read(fen) {\n  if (fen === 'start') fen = initial;\n  const pieces = new Map();\n  let row = 7,\n    col = 0;\n  for (const c of fen) {\n    switch (c) {\n      case ' ':\n      case '[':\n        return pieces;\n      case '/':\n        --row;\n        if (row < 0) return pieces;\n        col = 0;\n        break;\n      case '~':\n        {\n          const k = pos2key([col - 1, row]);\n          const piece = k && pieces.get(k);\n          if (piece) piece.promoted = true;\n          break;\n        }\n      default:\n        {\n          const nb = c.charCodeAt(0);\n          if (nb < 57) col += nb - 48;else {\n            const role = c.toLowerCase();\n            const key = pos2key([col, row]);\n            if (key) pieces.set(key, {\n              role: roles[role],\n              color: c === role ? 'black' : 'white'\n            });\n            ++col;\n          }\n        }\n    }\n  }\n  return pieces;\n}\nexport function write(pieces) {\n  return invRanks.map(y => cg.files.map(x => {\n    const piece = pieces.get(x + y);\n    if (piece) {\n      let p = letters[piece.role];\n      if (piece.color === 'white') p = p.toUpperCase();\n      if (piece.promoted) p += '~';\n      return p;\n    } else return '1';\n  }).join('')).join('/').replace(/1{2,}/g, s => s.length.toString());\n}\n//# sourceMappingURL=fen.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}