{"ast":null,"code":"/**\n * Author and copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/cm-chessboard\n * License: MIT, see file 'LICENSE'\n */\nexport const FEN = {\n  start: \"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1\",\n  empty: \"8/8/8/8/8/8/8/8\"\n};\nexport class Position {\n  constructor(fen = FEN.empty) {\n    this.squares = new Array(64).fill(null);\n    this.setFen(fen);\n  }\n  setFen(fen = FEN.empty) {\n    const parts = fen.replace(/^\\s*/, \"\").replace(/\\s*$/, \"\").split(/\\/|\\s/);\n    for (let part = 0; part < 8; part++) {\n      const row = parts[7 - part].replace(/\\d/g, str => {\n        const numSpaces = parseInt(str);\n        let ret = '';\n        for (let i = 0; i < numSpaces; i++) {\n          ret += '-';\n        }\n        return ret;\n      });\n      for (let c = 0; c < 8; c++) {\n        const char = row.substring(c, c + 1);\n        let piece = null;\n        if (char !== '-') {\n          if (char.toUpperCase() === char) {\n            piece = `w${char.toLowerCase()}`;\n          } else {\n            piece = `b${char}`;\n          }\n        }\n        this.squares[part * 8 + c] = piece;\n      }\n    }\n  }\n  getFen() {\n    let parts = new Array(8).fill(\"\");\n    for (let part = 0; part < 8; part++) {\n      let spaceCounter = 0;\n      for (let i = 0; i < 8; i++) {\n        const piece = this.squares[part * 8 + i];\n        if (!piece) {\n          spaceCounter++;\n        } else {\n          if (spaceCounter > 0) {\n            parts[7 - part] += spaceCounter;\n            spaceCounter = 0;\n          }\n          const color = piece.substring(0, 1);\n          const name = piece.substring(1, 2);\n          if (color === \"w\") {\n            parts[7 - part] += name.toUpperCase();\n          } else {\n            parts[7 - part] += name;\n          }\n        }\n      }\n      if (spaceCounter > 0) {\n        parts[7 - part] += spaceCounter;\n        spaceCounter = 0;\n      }\n    }\n    return parts.join(\"/\");\n  }\n  getPieces(pieceColor = undefined, pieceType = undefined, sortBy = ['k', 'q', 'r', 'b', 'n', 'p']) {\n    const pieces = [];\n    const sort = (a, b) => {\n      return sortBy.indexOf(a.name) - sortBy.indexOf(b.name);\n    };\n    for (let i = 0; i < 64; i++) {\n      const piece = this.squares[i];\n      if (piece) {\n        const type = piece.charAt(1);\n        const color = piece.charAt(0);\n        const square = Position.indexToSquare(i);\n        if (pieceType && pieceType !== type || pieceColor && pieceColor !== color) {\n          continue;\n        }\n        pieces.push({\n          name: type,\n          // deprecated, use type\n          type: type,\n          color: color,\n          position: square,\n          // deprecated, use square\n          square: square\n        });\n      }\n    }\n    if (sortBy) {\n      pieces.sort(sort);\n    }\n    return pieces;\n  }\n  movePiece(squareFrom, squareTo) {\n    if (!this.squares[Position.squareToIndex(squareFrom)]) {\n      console.warn(\"no piece on\", squareFrom);\n      return;\n    }\n    this.squares[Position.squareToIndex(squareTo)] = this.squares[Position.squareToIndex(squareFrom)];\n    this.squares[Position.squareToIndex(squareFrom)] = null;\n  }\n  setPiece(square, piece) {\n    this.squares[Position.squareToIndex(square)] = piece;\n  }\n  getPiece(square) {\n    return this.squares[Position.squareToIndex(square)];\n  }\n  static squareToIndex(square) {\n    const coordinates = Position.squareToCoordinates(square);\n    return coordinates[0] + coordinates[1] * 8;\n  }\n  static indexToSquare(index) {\n    return this.coordinatesToSquare([Math.floor(index % 8), index / 8]);\n  }\n  static squareToCoordinates(square) {\n    const file = square.charCodeAt(0) - 97;\n    const rank = square.charCodeAt(1) - 49;\n    return [file, rank];\n  }\n  static coordinatesToSquare(coordinates) {\n    const file = String.fromCharCode(coordinates[0] + 97);\n    const rank = String.fromCharCode(coordinates[1] + 49);\n    return file + rank;\n  }\n  toString() {\n    return this.getFen();\n  }\n  clone() {\n    const cloned = new Position();\n    cloned.squares = this.squares.slice(0);\n    return cloned;\n  }\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}